<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Potyog√≥s Am≈ëba - Mobile Pro</title>
    <style>
        /* --- T√âM√ÅK √âS V√ÅLTOZ√ìK --- */
        :root {
            --bg-color: #ecf0f1;
            --text-color: #2c3e50;
            --board-color: #34495e;
            --board-shadow: #2c3e50;
            --slot-empty: #bdc3c7;
            --p1-color: #e74c3c;
            --p1-shadow: #c0392b;
            --p2-color: #f1c40f;
            --p2-shadow: #f39c12;
            --winner-glow: rgba(255, 255, 255, 0.8);
            --font-main: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        [data-theme="dark"] {
            --bg-color: #121212;
            --text-color: #ecf0f1;
            --board-color: #2c3e50;
            --board-shadow: #000000;
            --slot-empty: #34495e;
            --p1-color: #ff5252;
            --p1-shadow: #b71c1c;
            --p2-color: #ffeb3b;
            --p2-shadow: #fbc02d;
            --winner-glow: rgba(255, 255, 255, 0.5);
        }

        [data-theme="contrast"] {
            --bg-color: #ffffff;
            --text-color: #000000;
            --board-color: #444;
            --board-shadow: #222;
            --slot-empty: #ddd;
            --p1-color: #007bff;
            --p1-shadow: #0056b3;
            --p2-color: #fd7e14;
            --p2-shadow: #c65f08;
            --winner-glow: rgba(0, 255, 0, 0.8);
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            margin: 0;
            padding: 10px;
            box-sizing: border-box;
            user-select: none;
            touch-action: manipulation; /* Zoom tilt√°sa double-tap-n√©l */
            transition: background 0.3s, color 0.3s;
            -webkit-tap-highlight-color: transparent;
        }

        h1 {
            margin: 10px 0;
            font-size: 1.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-align: center;
        }

        /* --- VEZ√âRL≈êK (Mobilra igaz√≠tva) --- */
        .controls {
            width: 100%;
            max-width: 500px;
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 12px;
            margin-bottom: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            justify-content: space-between;
        }

        .control-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        select, button {
            padding: 10px 12px; /* Nagyobb √©rint√©si fel√ºlet */
            font-size: 14px;
            border-radius: 8px;
            border: 1px solid rgba(0,0,0,0.2);
            background: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-main);
        }

        button.primary {
            background-color: var(--board-color);
            color: white;
            border: none;
            font-weight: 600;
            flex-grow: 1; /* Mobilon ny√∫ljon meg */
        }

        button:active { transform: scale(0.96); }

        .status {
            width: 100%;
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
            padding: 5px;
            background: rgba(0,0,0,0.05);
            border-radius: 6px;
            margin-top: 5px;
        }

        .theme-switch { display: flex; gap: 8px; }
        .theme-btn {
            width: 36px; height: 36px; /* Ujjbegy m√©ret */
            border-radius: 50%;
            border: 2px solid rgba(0,0,0,0.1);
            padding: 0;
        }

        /* --- J√ÅT√âKT√ÅBLA (Reszponz√≠v Grid) --- */
        .game-board-wrapper {
            width: 100%;
            max-width: 500px; /* Tablet/Desktop limit */
            aspect-ratio: 7/6; /* A t√°bla ar√°nya fix */
            position: relative;
        }

        .game-board {
            background-color: var(--board-color);
            width: 100%;
            height: 100%;
            padding: 2%; /* Relat√≠v padding */
            border-radius: 10px;
            box-sizing: border-box;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1.5%;
            transition: transform 0.1s;
        }

        .column {
            display: flex;
            flex-direction: column; /* Fentr≈ël lefel√© renderel√©s, de a logika ford√≠tott */
            gap: 1.5%;
            cursor: pointer;
            position: relative;
        }

        /* Hover effekt csak PC-n, mobilon zavar√≥ */
        @media (hover: hover) {
            .column:hover::after {
                content: '';
                position: absolute;
                top: -5px; left: 0; right: 0; bottom: -5px;
                background: rgba(255,255,255,0.1);
                border-radius: 50px;
                pointer-events: none;
            }
        }

        .slot {
            width: 100%;
            aspect-ratio: 1/1; /* Mindig k√∂r alak√∫ marad */
            background-color: var(--bg-color);
            border-radius: 50%;
            position: relative;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.3);
            z-index: 1; 
        }

        .piece {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: absolute;
            top: 0; left: 0;
            z-index: 2;
            will-change: transform; /* Mobil GPU optimaliz√°ci√≥ */
        }

        .piece.red {
            background: radial-gradient(circle at 35% 35%, #fff, var(--p1-color));
            box-shadow: 0 2px 0 var(--p1-shadow);
        }

        .piece.yellow {
            background: radial-gradient(circle at 35% 35%, #fff, var(--p2-color));
            box-shadow: 0 2px 0 var(--p2-shadow);
        }

        /* Effektek */
        .shake { animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-2px, 0, 0); }
            40%, 60% { transform: translate3d(2px, 0, 0); }
        }

        .winner-slot { animation: winnerPulse 1s infinite alternate; z-index: 10; }
        @keyframes winnerPulse {
            from { box-shadow: 0 0 5px var(--winner-glow), inset 0 0 5px var(--winner-glow); transform: scale(1); }
            to { box-shadow: 0 0 15px var(--winner-glow), inset 0 0 10px var(--winner-glow); transform: scale(1.05); }
        }
    </style>
</head>
<body>

    <h1>Potyog√≥s Am≈ëba</h1>

    <div class="controls">
        <div class="control-group" style="flex-grow: 1;">
            <select id="difficulty">
                <option value="1">K√∂nny≈±</option>
                <option value="2">K√∂zepes</option>
                <option value="4" selected>Halad√≥</option>
                <option value="6">Mester</option>
            </select>
            <button class="primary" onclick="game.resetGame()">√öj J√°t√©k</button>
        </div>
        
        <div class="control-group">
            <button id="mute-btn" onclick="soundManager.toggleMute()">üîä</button>
            <div class="theme-switch">
                <button class="theme-btn" style="background:#ecf0f1" onclick="setTheme('light')"></button>
                <button class="theme-btn" style="background:#333" onclick="setTheme('dark')"></button>
                <button class="theme-btn" style="background:#2980b9" onclick="setTheme('contrast')"></button>
            </div>
        </div>
        
        <div class="status" id="status">Ind√≠t√°s: Kattints a t√°bl√°ra!</div>
    </div>

    <div class="game-board-wrapper">
        <div id="board-container" class="game-board"></div>
    </div>

<script>
/**
 * --- AUDIO RENDSZER ---
 */
class SoundManager {
    constructor() {
        this.ctx = null;
        this.muted = false;
    }

    init() {
        if (!this.ctx) {
            this.ctx = new (window.AudioContext || window.webkitAudioContext)();
        }
    }

    toggleMute() {
        this.muted = !this.muted;
        document.getElementById('mute-btn').innerText = this.muted ? 'üîá' : 'üîä';
        if (this.ctx && this.ctx.state === 'suspended') this.ctx.resume();
    }

    playTone(freq, type, duration, vol = 0.1) {
        if (this.muted || !this.ctx) return;
        const osc = this.ctx.createOscillator();
        const gain = this.ctx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
        gain.gain.setValueAtTime(vol, this.ctx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + duration);
        osc.connect(gain);
        gain.connect(this.ctx.destination);
        osc.start();
        osc.stop(this.ctx.currentTime + duration);
    }

    playDrop() { 
        this.init();
        this.playTone(300, 'sine', 0.2, 0.2);
        setTimeout(() => this.playTone(150, 'triangle', 0.1, 0.2), 50);
    }

    playError() { 
        this.init();
        this.playTone(150, 'sawtooth', 0.2, 0.1); 
    }

    playWin() {
        this.init();
        if (this.muted) return;
        [523.25, 659.25, 783.99, 1046.50].forEach((freq, i) => {
            setTimeout(() => this.playTone(freq, 'sine', 0.4, 0.2), i * 150);
        });
    }
}
const soundManager = new SoundManager();

/**
 * --- J√ÅT√âK MOTOR ---
 */
const ROWS = 6;
const COLS = 7;
const PLAYER = 1; 
const AI = 2;     
const EMPTY = 0;

class Connect4 {
    constructor() {
        this.board = [];
        this.currentPlayer = PLAYER;
        this.gameActive = true;
        this.difficulty = 4;
        this.uiBoard = document.getElementById('board-container');
        this.statusDisplay = document.getElementById('status');
        this.isDropping = false;
        
        this.initBoard();
        this.renderBoard();
        
        document.getElementById('difficulty').addEventListener('change', (e) => {
            this.difficulty = parseInt(e.target.value);
            this.resetGame();
        });
    }

    initBoard() {
        this.board = Array(ROWS).fill().map(() => Array(COLS).fill(EMPTY));
    }

    resetGame() {
        this.initBoard();
        this.currentPlayer = PLAYER;
        this.gameActive = true;
        this.isDropping = false;
        this.updateStatus("Te j√∂ssz!");
        
        document.querySelectorAll('.piece').forEach(p => p.remove());
        document.querySelectorAll('.slot').forEach(s => s.classList.remove('winner-slot'));
        this.uiBoard.classList.remove('shake');
    }

    renderBoard() {
        this.uiBoard.innerHTML = '';
        for (let c = 0; c < COLS; c++) {
            const colDiv = document.createElement('div');
            colDiv.classList.add('column');
            colDiv.dataset.col = c;
            // Mobilon a touchstart azonnal reag√°l, de a click is kell fallbacknek
            colDiv.addEventListener('click', (e) => {
                e.preventDefault(); // Dupla esem√©ny elker√ºl√©se
                this.handleHumanMove(c);
            });

            for (let r = ROWS - 1; r >= 0; r--) { 
                const slot = document.createElement('div');
                slot.classList.add('slot');
                slot.dataset.row = r;
                slot.dataset.col = c;
                colDiv.appendChild(slot);
            }
            this.uiBoard.appendChild(colDiv);
        }
    }

    updateStatus(msg) { this.statusDisplay.innerText = msg; }

    getNextOpenRow(board, col) {
        for (let r = 0; r < ROWS; r++) {
            if (board[r][col] === EMPTY) return r;
        }
        return -1;
    }

    handleHumanMove(col) {
        if (!this.gameActive || this.currentPlayer !== PLAYER || this.isDropping) return;
        soundManager.init(); // Els≈ë interakci√≥ra audio init

        const row = this.getNextOpenRow(this.board, col);
        if (row !== -1) {
            this.makeMove(row, col, PLAYER);
        } else {
            soundManager.playError();
        }
    }

    async makeMove(row, col, player) {
        this.isDropping = true;
        this.board[row][col] = player;
        
        await this.animateDrop(row, col, player);
        this.triggerImpactEffect();

        if (this.checkWin(this.board, player)) {
            this.endGame(player);
            this.isDropping = false;
        } else if (this.checkDraw(this.board)) {
            this.endGame(0);
            this.isDropping = false;
        } else {
            this.isDropping = false;
            if (player === PLAYER) {
                this.currentPlayer = AI;
                this.updateStatus("Gondolkodom...");
                setTimeout(() => this.makeAIMove(), 50);
            } else {
                this.currentPlayer = PLAYER;
                this.updateStatus("Te j√∂ssz!");
            }
        }
    }

    animateDrop(row, col, player) {
        return new Promise(resolve => {
            const slot = document.querySelector(`.slot[data-row='${row}'][data-col='${col}']`);
            if (slot) {
                // DINAMIKUS MAGASS√ÅG SZ√ÅM√çT√ÅS MOBILHOZ
                // Megm√©rj√ºk, mekkora egy slot a k√©perny≈ën
                const slotHeight = slot.getBoundingClientRect().height;
                // A slotok k√∂z√∂tt van gap (1.5%), ezt durv√°n becs√ºlj√ºk vagy beleolvasztjuk
                const gap = slotHeight * 0.1; // Kb 10% a gap ar√°nya
                const dropDistance = (ROWS - 1 - row) * (slotHeight + gap) + slotHeight;

                const piece = document.createElement('div');
                piece.classList.add('piece');
                piece.classList.add(player === PLAYER ? 'red' : 'yellow');
                
                // CSS Transform-ot haszn√°lunk, ami hardveresen gyors√≠tott
                piece.style.transform = `translateY(-${dropDistance}px)`;
                piece.style.transition = "transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94)";
                
                slot.appendChild(piece);
                
                // K√©nyszer√≠tett reflow
                piece.offsetHeight; 
                
                // Zuhan√°s
                piece.style.transform = "translateY(0)";

                setTimeout(() => resolve(), 400);
            } else {
                resolve();
            }
        });
    }

    triggerImpactEffect() {
        soundManager.playDrop();
        this.uiBoard.classList.remove('shake');
        void this.uiBoard.offsetWidth;
        this.uiBoard.classList.add('shake');
    }

    endGame(winner) {
        this.gameActive = false;
        if (winner === PLAYER) {
            this.updateStatus("Gy≈ëzelem!");
            soundManager.playWin();
            this.highlightWin(PLAYER);
        } else if (winner === AI) {
            this.updateStatus("Vesztett√©l.");
            this.highlightWin(AI);
        } else {
            this.updateStatus("D√∂ntetlen!");
        }
    }

    checkWin(board, player, returnCoords = false) {
        // Ellen≈ërz√©s logika (v√°ltozatlan)
        // Horizont√°lis
        for (let r=0;r<ROWS;r++) for (let c=0;c<COLS-3;c++)
            if (board[r][c]===player && board[r][c+1]===player && board[r][c+2]===player && board[r][c+3]===player)
                return returnCoords ? [[r,c],[r,c+1],[r,c+2],[r,c+3]] : true;
        // Vertik√°lis
        for (let r=0;r<ROWS-3;r++) for (let c=0;c<COLS;c++)
            if (board[r][c]===player && board[r+1][c]===player && board[r+2][c]===player && board[r+3][c]===player)
                return returnCoords ? [[r,c],[r+1,c],[r+2,c],[r+3,c]] : true;
        // √Åtl√≥s /
        for (let r=0;r<ROWS-3;r++) for (let c=0;c<COLS-3;c++)
            if (board[r][c]===player && board[r+1][c+1]===player && board[r+2][c+2]===player && board[r+3][c+3]===player)
                return returnCoords ? [[r,c],[r+1,c+1],[r+2,c+2],[r+3,c+3]] : true;
        // √Åtl√≥s \
        for (let r=3;r<ROWS;r++) for (let c=0;c<COLS-3;c++)
            if (board[r][c]===player && board[r-1][c+1]===player && board[r-2][c+2]===player && board[r-3][c+3]===player)
                return returnCoords ? [[r,c],[r-1,c+1],[r-2,c+2],[r-3,c+3]] : true;
        return false;
    }

    checkDraw(board) { return board.every(row => row.every(cell => cell !== EMPTY)); }

    highlightWin(player) {
        const coords = this.checkWin(this.board, player, true);
        if (coords) coords.forEach(([r, c]) => {
            const slot = document.querySelector(`.slot[data-row='${r}'][data-col='${c}']`);
            if (slot) slot.classList.add('winner-slot');
        });
    }

    // --- AI (Minimax) ---
    makeAIMove() {
        let col;
        if (this.difficulty === 1) {
             if (Math.random() < 0.3) {
                 const valid = this.getValidLocations(this.board);
                 col = valid[Math.floor(Math.random() * valid.length)];
             } else col = this.minimax(this.board, 2, -Infinity, Infinity, true)[1];
        } else {
            col = this.minimax(this.board, this.difficulty, -Infinity, Infinity, true)[1];
        }
        if (col === undefined) col = this.getValidLocations(this.board)[0];
        
        const row = this.getNextOpenRow(this.board, col);
        this.makeMove(row, col, AI);
    }

    getValidLocations(board) {
        const valid = [];
        for (let c=0; c<COLS; c++) if (board[ROWS-1][c] === EMPTY) valid.push(c);
        valid.sort((a,b) => Math.abs(a-3) - Math.abs(b-3));
        return valid;
    }

    evaluateWindow(w, p) {
        let score = 0;
        const o = p === AI ? PLAYER : AI;
        let pc = w.filter(c => c === p).length;
        let ec = w.filter(c => c === EMPTY).length;
        let oc = w.filter(c => c === o).length;
        if (pc === 4) score += 100;
        else if (pc === 3 && ec === 1) score += 5;
        else if (pc === 2 && ec === 2) score += 2;
        if (oc === 3 && ec === 1) score -= 4;
        return score;
    }

    scorePosition(board, piece) {
        let score = 0;
        const ca = []; for(let r=0;r<ROWS;r++) ca.push(board[r][3]);
        score += ca.filter(c => c === piece).length * 3;
        
        for (let r=0;r<ROWS;r++) for (let c=0;c<COLS-3;c++) 
            score += this.evaluateWindow([board[r][c], board[r][c+1], board[r][c+2], board[r][c+3]], piece);
        for (let c=0;c<COLS;c++) for (let r=0;r<ROWS-3;r++)
            score += this.evaluateWindow([board[r][c], board[r+1][c], board[r+2][c], board[r+3][c]], piece);
        for (let r=0;r<ROWS-3;r++) for (let c=0;c<COLS-3;c++)
            score += this.evaluateWindow([board[r][c], board[r+1][c+1], board[r+2][c+2], board[r+3][c+3]], piece);
        for (let r=0;r<ROWS-3;r++) for (let c=0;c<COLS-3;c++)
            score += this.evaluateWindow([board[r+3][c], board[r+2][c+1], board[r+1][c+2], board[r][c+3]], piece);
        return score;
    }

    isTerminalNode(board) {
        return this.checkWin(board, PLAYER) || this.checkWin(board, AI) || this.getValidLocations(board).length === 0;
    }

    minimax(board, depth, alpha, beta, maximizingPlayer) {
        const valid = this.getValidLocations(board);
        const isTerminal = this.isTerminalNode(board);
        if (depth === 0 || isTerminal) {
            if (isTerminal) {
                if (this.checkWin(board, AI)) return [1000000, undefined];
                else if (this.checkWin(board, PLAYER)) return [-1000000, undefined];
                else return [0, undefined];
            } else return [this.scorePosition(board, AI), undefined];
        }
        if (maximizingPlayer) {
            let val = -Infinity, col = valid[Math.floor(Math.random()*valid.length)];
            for (let c of valid) {
                const r = this.getNextOpenRow(board, c);
                board[r][c] = AI;
                const newScore = this.minimax(board, depth-1, alpha, beta, false)[0];
                board[r][c] = EMPTY;
                if (newScore > val) { val = newScore; col = c; }
                alpha = Math.max(alpha, val);
                if (alpha >= beta) break;
            }
            return [val, col];
        } else {
            let val = Infinity, col = valid[Math.floor(Math.random()*valid.length)];
            for (let c of valid) {
                const r = this.getNextOpenRow(board, c);
                board[r][c] = PLAYER;
                const newScore = this.minimax(board, depth-1, alpha, beta, true)[0];
                board[r][c] = EMPTY;
                if (newScore < val) { val = newScore; col = c; }
                beta = Math.min(beta, val);
                if (alpha >= beta) break;
            }
            return [val, col];
        }
    }
}

function setTheme(theme) { document.documentElement.setAttribute('data-theme', theme); }

const game = new Connect4();
</script>
</body>
</html>
